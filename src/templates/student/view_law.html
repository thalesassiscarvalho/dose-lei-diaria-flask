{% extends "base.html" %}

{% block title %}{{ law.title }} - Dose de Lei Di√°ria{% endblock %}

{% block head_extra %}
<style>
    .law-content-container {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        color: #1f2937; /* Dark gray text for readability */
        line-height: 1.7;
        /* Prote√ß√£o contra sele√ß√£o de texto para c√≥pia - Mantida conforme original */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        /* Adicionando borda azul clara */
        border: 1px solid #bfdbfe; /* Tailwind blue-200 */
    }
    .law-content-container h1, .law-content-container h2, .law-content-container h3 {
        margin-top: 1.5em;
        margin-bottom: 0.5em;
        font-weight: 600;
    }
    .law-content-container p {
        margin-bottom: 1em;
    }
    .law-content-container ul, .law-content-container ol {
        margin-left: 1.5em;
        margin-bottom: 1em;
    }
    .law-content-container li {
        margin-bottom: 0.5em;
    }
    .law-content-container strong { font-weight: bold; }
    .law-content-container em { font-style: italic; }
    .law-content-container u { text-decoration: underline; }
    .law-content-container s { text-decoration: line-through; }
    .ql-bg-yellow { background-color: yellow; }
    .ql-bg-red { background-color: red; }
    .completed-banner {
        background-color: #d1fae5; /* Light green */
        color: #065f46; /* Dark green */
        padding: 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1.5rem;
        border: 1px solid #a7f3d0;
    }
    .last-read-info {
        background-color: #e0e7ff; /* Indigo 100 */
        color: #3730a3; /* Indigo 800 */
        padding: 0.75rem 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1.5rem;
        border: 1px solid #c7d2fe; /* Indigo 200 */
        font-size: 0.9rem;
    }
    .save-article-form {
        margin-top: 1.5rem;
        padding: 1rem;
        background-color: #f9fafb; /* Gray 50 */
        border: 1px solid #e5e7eb; /* Gray 200 */
        border-radius: 0.5rem;
    }
    /* Estilos para os bot√µes de toggle */
    .toggle-button {
        background-color: #e5e7eb; /* gray-200 */
        color: #374151; /* gray-700 */
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
        border: 1px solid #d1d5db; /* gray-300 */
    }
    .toggle-button:hover {
        background-color: #d1d5db; /* gray-300 */
    }
    .toggle-button.active {
        background-color: #3b82f6; /* blue-500 */
        color: white;
        border-color: #2563eb; /* blue-600 */
    }
    .toggle-button.active:hover {
        background-color: #2563eb; /* blue-600 */
    }
    .hidden-content {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 space-y-2 sm:space-y-0">
    <h1 class="text-xl md:text-2xl font-bold text-blue-700">{{ law.title }}</h1>
    <a href="{{ url_for("student.dashboard") }}" class="text-sm md:text-base text-purple-600 hover:text-purple-800 whitespace-nowrap self-end sm:self-center">
        <i class="fas fa-arrow-left mr-1 md:mr-2"></i> Voltar ao Painel
    </a>
</div>

{% if is_completed %}
<div class="completed-banner" role="alert">
    <i class="fas fa-check-circle mr-2"></i> Voc√™ j√° concluiu esta legisla√ß√£o!
</div>
{% elif last_read_article %}
<div class="last-read-info" role="alert">
    <i class="fas fa-bookmark mr-2"></i> Voc√™ parou no artigo: <strong>{{ last_read_article }}</strong>
</div>
{% endif %}

<!-- Bot√µes de Toggle -->
<div class="flex space-x-2 mb-4">
    <button id="toggle-comments-btn" class="toggle-button active">
        <i class="fas fa-eye mr-1"></i> Mostrar Coment√°rios
    </button>
    <button id="toggle-jurisprudence-btn" class="toggle-button active">
        <i class="fas fa-gavel mr-1"></i> Mostrar Jurisprud√™ncias
    </button>
</div>
<!-- Fim dos Bot√µes de Toggle -->

<div class="law-content-container" id="law-content">
    {% if law.description %}
        <p class="text-gray-600 italic mb-6">{{ law.description }}</p>
    {% endif %}
    
    {{ law.content | safe }}
</div>

{% if not is_completed %}
<!-- Save Last Read Article Form -->
<div class="save-article-form">
    <form action="{{ url_for("student.save_last_read", law_id=law.id) }}" method="POST" class="flex items-center space-x-3">
        <label for="last_article" class="text-sm font-medium text-gray-700">Parou no artigo n¬∫:</label>
        <input type="text" id="last_article" name="last_article" 
               placeholder="Ex: 15" value="{{ last_read_article or '' }}"
               class="shadow-sm appearance-none border border-gray-300 rounded-md py-1 px-2 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent w-24">
        <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-1 px-3 rounded-md transition duration-300 text-sm">
            <i class="fas fa-save mr-1"></i> Salvar Posi√ß√£o
        </button>
    </form>
</div>

<!-- Mark as Complete Button -->
<div class="mt-8 text-center">
    <form action="{{ url_for("student.mark_complete", law_id=law.id) }}" method="POST">
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 text-lg shadow-md">
            <i class="fas fa-check mr-2"></i> Marcar como Conclu√≠do
        </button>
    </form>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
// --- Script para Ocultar/Mostrar Coment√°rios e Jurisprud√™ncias ---
document.addEventListener('DOMContentLoaded', function() {
    const lawContent = document.getElementById('law-content');
    const toggleCommentsBtn = document.getElementById('toggle-comments-btn');
    const toggleJurisprudenceBtn = document.getElementById('toggle-jurisprudence-btn');

    // Seletores baseados nos estilos inline identificados
    const commentSelector = 'p[style*="background-color: #f0fdf4"]';
    const jurisprudenceSelector = 'p[style*="background-color: #fef2f2"]';

    let commentsVisible = true;
    let jurisprudenceVisible = true;

    function toggleElements(selector, isVisible) {
        const elements = lawContent.querySelectorAll(selector);
        elements.forEach(el => {
            el.style.display = isVisible ? '' : 'none'; // Usa display vazio para voltar ao padr√£o
        });
    }

    // Inicialmente, garantir que todos estejam vis√≠veis (caso o CSS padr√£o seja diferente)
    toggleElements(commentSelector, commentsVisible);
    toggleElements(jurisprudenceSelector, jurisprudenceVisible);

    // Event listener para o bot√£o de coment√°rios
    toggleCommentsBtn.addEventListener('click', function() {
        commentsVisible = !commentsVisible;
        toggleElements(commentSelector, commentsVisible);
        this.classList.toggle('active', commentsVisible);
        this.innerHTML = commentsVisible 
            ? '<i class="fas fa-eye mr-1"></i> Mostrar Coment√°rios' 
            : '<i class="fas fa-eye-slash mr-1"></i> Ocultar Coment√°rios';
        // Ajuste: Se estava ativo (mostrando), agora n√£o est√° mais (ocultando), e vice-versa.
        // Corre√ß√£o na l√≥gica do texto e classe:
        if (commentsVisible) {
            this.classList.add('active');
            this.innerHTML = '<i class="fas fa-eye mr-1"></i> Mostrar Coment√°rios'; // Texto quando est√° vis√≠vel (bot√£o para ocultar)
        } else {
            this.classList.remove('active');
            this.innerHTML = '<i class="fas fa-eye-slash mr-1"></i> Ocultar Coment√°rios'; // Texto quando est√° oculto (bot√£o para mostrar)
        }
        // Corre√ß√£o final da l√≥gica do texto e classe:
        this.classList.toggle('active', !commentsVisible); // Bot√£o fica 'inativo' (cinza) quando o conte√∫do est√° vis√≠vel
        this.innerHTML = commentsVisible
            ? '<i class="fas fa-eye-slash mr-1"></i> Ocultar Coment√°rios' // Conte√∫do vis√≠vel, bot√£o para ocultar
            : '<i class="fas fa-eye mr-1"></i> Mostrar Coment√°rios'; // Conte√∫do oculto, bot√£o para mostrar
    });

    // Event listener para o bot√£o de jurisprud√™ncias
    toggleJurisprudenceBtn.addEventListener('click', function() {
        jurisprudenceVisible = !jurisprudenceVisible;
        toggleElements(jurisprudenceSelector, jurisprudenceVisible);
        this.classList.toggle('active', !jurisprudenceVisible); // Bot√£o fica 'inativo' (cinza) quando o conte√∫do est√° vis√≠vel
        this.innerHTML = jurisprudenceVisible
            ? '<i class="fas fa-eye-slash mr-1"></i> Ocultar Jurisprud√™ncias' // Conte√∫do vis√≠vel, bot√£o para ocultar
            : '<i class="fas fa-eye mr-1"></i> Mostrar Jurisprud√™ncias'; // Conte√∫do oculto, bot√£o para mostrar
    });

    // Inicializar estado dos bot√µes (come√ßam 'inativos' pois o conte√∫do est√° vis√≠vel)
    toggleCommentsBtn.classList.remove('active');
    toggleCommentsBtn.innerHTML = '<i class="fas fa-eye-slash mr-1"></i> Ocultar Coment√°rios';
    toggleJurisprudenceBtn.classList.remove('active');
    toggleJurisprudenceBtn.innerHTML = '<i class="fas fa-eye-slash mr-1"></i> Ocultar Jurisprud√™ncias';

});
// --- Fim do Script de Toggle ---


// üõ°Ô∏è PROTE√á√ïES DISCRETAS - APENAS C√ìPIA E IMPRESS√ÉO (Mantidas conforme original)

// ‚úÖ Anti-impress√£o (Ctrl+P)
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && (e.key === 'p' || e.key === 'P')) {
        e.preventDefault();
        e.stopPropagation();
        alert('Impress√£o n√£o permitida neste conte√∫do.');
        return false;
    }
});

// ‚úÖ Anti-c√≥pia (Ctrl+C, Ctrl+A, Ctrl+X)
document.addEventListener('keydown', function(e) {
    // Bloquear Ctrl+C (copiar)
    if (e.ctrlKey && (e.key === 'c' || e.key === 'C')) {
        e.preventDefault();
        e.stopPropagation();
        alert('C√≥pia de conte√∫do n√£o permitida.');
        return false;
    }
    
    // Bloquear Ctrl+A (selecionar tudo)
    if (e.ctrlKey && (e.key === 'a' || e.key === 'A')) {
        e.preventDefault();
        e.stopPropagation();
        alert('Sele√ß√£o total n√£o permitida.');
        return false;
    }
    
    // Bloquear Ctrl+X (recortar)
    if (e.ctrlKey && (e.key === 'x' || e.key === 'X')) {
        e.preventDefault();
        e.stopPropagation();
        alert('Recorte n√£o permitido.');
        return false;
    }
});

// ‚úÖ Prote√ß√£o contra sele√ß√£o de texto
document.addEventListener('selectstart', function(e) {
    e.preventDefault();
    return false;
});

// ‚úÖ Menu de contexto desabilitado (bot√£o direito)
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    alert('Menu de contexto desabilitado.');
    return false;
});
</script>
{% endblock %}

